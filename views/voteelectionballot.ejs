<!DOCTYPE html>
<html>
  <head>
    <%- include('./partials/head') -%> <!-- Including head partial -->
    <script>
      function handleDragStart(e) {
        this.style.opacity = '0.4';
      }

      function handleDragEnd(e) {
        this.style.opacity = '1';
      }

      let items = document.querySelectorAll('.container .box');
      items.forEach(function (item) {
        item.addEventListener('dragstart', handleDragStart);
        item.addEventListener('dragend', handleDragEnd);
      });

      document.addEventListener('DOMContentLoaded', (event) => {

function handleDragStart(e) {
  this.style.opacity = '0.4';

  dragSrcEl = this;

e.dataTransfer.effectAllowed = 'move';
e.dataTransfer.setData('text/html', this.innerHTML);
}

function handleDragEnd(e) {
  this.style.opacity = '1';

  items.forEach(function (item) {
    item.classList.remove('over');
  });
}

function handleDragOver(e) {
  e.preventDefault();
  return false;
}

function handleDragEnter(e) {
  this.classList.add('over');
}

function handleDragLeave(e) {
  this.classList.remove('over');
}

let items = document.querySelectorAll('.container .box');
items.forEach(function(item) {
  item.addEventListener('dragstart', handleDragStart);
  item.addEventListener('dragover', handleDragOver);
  item.addEventListener('dragenter', handleDragEnter);
  item.addEventListener('dragleave', handleDragLeave);
  item.addEventListener('dragend', handleDragEnd);
  item.addEventListener('drop', handleDrop);
});
});

function handleDrop(e) {
  e.stopPropagation();

  if (dragSrcEl !== this) {
    dragSrcEl.innerHTML = this.innerHTML;
    this.innerHTML = e.dataTransfer.getData('text/html');
  }

  return false;
}

  items.forEach(function(item) {
    item.addEventListener('dragstart', handleDragStart);
    item.addEventListener('dragover', handleDragOver);
    item.addEventListener('dragenter', handleDragEnter);
    item.addEventListener('dragleave', handleDragLeave);
    item.addEventListener('dragend', handleDragEnd);
    item.addEventListener('drop', handleDrop);
  });

    </script>
  </head>
  <body>
    <%- include('./partials/navmenu') -%>
    <h1> CAST YOUR BALLOT </h1>
    <h2> Title: <%= electioninfo.title %> </h2>
    <h2> Description: <%= electioninfo.description %> </h2>
    <% if (electioninfo.type=="cpl") { %>
        <h3> Copeland election </h3>
    <% } %>
    <h3> Options </h3>
    <form method="POST">
    <div class="container">
    <% for (var option in electioninfo.options) { %>
      <div draggable="true" class="box"> 
        <input type='text' value='<%= electioninfo.options[option] %>' name="choice[<%= option %>]" id="choice[<%= option %>]" readonly>
      </div> <!-- changed from div-->
    <% } %>
    </div> <!-- for container for drag and drop-->
    <input type="submit" value="ENTER BALLOT">
  </form>
  </body>
  </html>